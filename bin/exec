#!/usr/bin/env bash

set -euo pipefail

BASEDIR="${BASH_SOURCE%/*}"
THATIQ_HOME="/usr/local/thatiq"

watch-css() {
  command docker-compose exec web $THATIQ_HOME/node_modules/.bin/node-sass \
    -w -r -o $THATIQ_HOME/dist/static/css $THATIQ_HOME/web/static/sass/application.scss
}

build-css() {
  command docker-compose exec web $THATIQ_HOME/node_modules/.bin/node-sass \
    $THATIQ_HOME/web/static/sass/application.scss $THATIQ_HOME/dist/static/css/application.css \
    && docker-compose exec web $THATIQ_HOME/node_modules/.bin/postcss \
      $THATIQ_HOME/dist/static/css/application.css -o $THATIQ_HOME/dist/static/css/application.css
}

test-server() {
  command docker-compose exec web /usr/local/thatiq/node_modules/.bin/cross-env \
    NODE_ENV=test BABEL_ENV=commonjs MONGODB_URI="mongodb://db:27017" \
    /usr/local/thatiq/node_modules/.bin/mocha /usr/local/thatiq/test/server/index.js \
      --require @babel/register
}

# Run a function name in the context of this script
eval "$@"
